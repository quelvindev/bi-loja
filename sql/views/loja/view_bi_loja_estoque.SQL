CREATE OR REPLACE VIEW  view_bi_loja_estoque AS 

SELECT
        PCEST.CODFILIAL,
        PCFORNEC.CODFORNEC,
        PCEST.CODPROD,
        PCEST.QTESTGER,
        (NVL(PCEST.QTESTGER,0)*NVL(PCTABPR.PVENDA,0))*0.9 VAL_ESTOQUE,
        NVL(PKG_ESTOQUE.ESTOQUE_DISPONIVEL(PCEST.CODPROD,PCEST.CODFILIAL,'V', NULL),0) EST_DISP,
        NVL(PCEST.QTRESERV,0) EST_RESEV,
        NVL(PCEST.QTBLOQUEADA,0) EST_BLO,
        NVL(PCEST.QTPENDENTE,0) EST_PEND,
        NVL(PCEST.QTINDENIZ,0) EST_AVA,
        NVL(PCEST.QTGIRODIA,0) GIRO_DIA,
        (NVL(PKG_ESTOQUE.ESTOQUE_DISPONIVEL(PCEST.CODPROD,PCEST.CODFILIAL,'V', NULL),0)*
           ((SELECT PCTABPR.PVENDA FROM PCTABPR WHERE PCTABPR.CODPROD = PCEST.CODPROD AND PCTABPR.NUMREGIAO = 1 ))  )CUST_EST_DISPON,   
        NVL((PCEST.QTESTGER  *  PCEST.CUSTOFIN ),0) CUST_GER,
        NVL(PCEST.QTPEDIDA,0) QT_PEDIDA,
        NVL(PCEST.QTESTANT,0) QT_ANT,
        PCEST.QTVENDMES
        
    FROM  
        PCEST,PCPRODUT, PCFORNEC, PCTABPR
    WHERE 
        PCEST.CODPROD  = PCPRODUT.CODPROD 
        AND PCPRODUT.CODFORNEC = PCFORNEC.CODFORNEC 
        AND PCEST.CODPROD = PCTABPR.CODPROD 
        AND PCTABPR.NUMREGIAO = 1
        AND PCEST.CODFILIAL NOT IN(7,8)
    
WITH READ ONLY
